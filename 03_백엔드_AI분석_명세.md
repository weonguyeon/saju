# AI ë¶„ì„ ëª¨ë“ˆ ëª…ì„¸ì„œ (ai_analysis.py)

## ğŸ“Œ ê°œìš”

`AIAnalysis` í´ë˜ìŠ¤ëŠ” OpenAI GPT-4oë¥¼ í™œìš©í•œ ì‹¬ì¸µ ì‚¬ì£¼ ë¶„ì„ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. ê¸°ë³¸ ì‚¬ì£¼ ë¡œì§ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ í’ë¶€í•œ ì„œìˆ í˜• í•´ì„ì„ ìƒì„±í•©ë‹ˆë‹¤.

---

## ğŸ”§ í´ë˜ìŠ¤ êµ¬ì¡°

```python
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()

class AIAnalysis:
    def __init__(self):
        self.api_key = os.getenv("OPENAI_API_KEY")
        if self.api_key:
            self.client = OpenAI(api_key=self.api_key)
        else:
            self.client = None
```

---

## ğŸ“¥ ì…ë ¥ íŒŒë¼ë¯¸í„°

`get_deep_analysis(name, gender, pillars, ohaeng, ten_stars_list, current_daewun, birth_context)`

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì˜ˆì‹œ |
|----------|------|------|
| name | str | "í™ê¸¸ë™" |
| gender | str | "male" ë˜ëŠ” "female" |
| pillars | dict | ì‚¬ì£¼ ì›êµ­ ë°ì´í„° |
| ohaeng | dict | `{'percentages': {'wood': 25.0, ...}}` |
| ten_stars_list | str | "ë¹„ê²¬ 2, ì‹ì‹  1, ì •ì¬ 3" |
| current_daewun | str | "5ì„¸ ëŒ€ìš´ (ì„ì¶•)" |
| birth_context | str | "1990ë…„ìƒ (36ì„¸)" |

---

## ğŸ¯ GPT í”„ë¡¬í”„íŠ¸ ì „ë¬¸

```
# Role: 2030 ë§ì¶¤í˜• ë¼ì´í”„ ì „ëµê°€ & í˜„ëŒ€ ëª…ë¦¬í•™ ë§ˆìŠ¤í„°
ë‹¹ì‹ ì€ ì‚¬ìš©ìì˜ '{birth_context}'ë¼ëŠ” ìƒì•  ì£¼ê¸°ì  ë°°ê²½ì„ ê¹Šì´ ê³ ë ¤í•˜ì—¬ ì¡°ì–¸í•˜ëŠ” ì „ë¬¸ ë¶„ì„ê°€ì…ë‹ˆë‹¤.

# Input Data
- ì´ë¦„: {name}, ì„±ë³„: {gender}, ë‚˜ì´/ìƒë…„: {birth_context}
- ë³¸ì›(ì¼ê°„): {day_stem}
- ì‚¬ì£¼ ì›êµ­: ì—°:[{ë…„ê°„}{ë…„ì§€}] ì›”:[{ì›”ê°„}{ì›”ì§€}] ì¼:[{ì¼ê°„}{ì¼ì§€}] ì‹œ:[{ì‹œê°„}{ì‹œì§€}]
- ì‹­ì‹  êµ¬ì„±: {ten_stars_list}
- ì˜¤í–‰ ì ìˆ˜: {ohaeng_str}
- í˜„ì¬ ëŒ€ìš´: {current_daewun}

# Analysis Roadmap & Output JSON Structure
ëª¨ë“  ë‹µë³€ì€ ë‹¤ìŒ í‚¤ë¥¼ ê°€ì§„ JSON í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•˜ì„¸ìš”. ê° í•„ë“œëŠ” **ìµœì†Œ 8~12ë¬¸ì¥ ì´ìƒì˜ í’ë¶€í•œ ì¥ë¬¸**ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.

1. total_summary: [í‰ìƒì‚¬ì£¼ ì´í‰] ì‚¶ì˜ ëª©ì , ìš´ì˜ íë¦„, ê¸°ì§ˆê³¼ ë¯¸ë˜ í†µì°°ì„ ì—ì„¸ì´ì²˜ëŸ¼ ì„œìˆ 
2. gmhs: [ìƒì• ì£¼ê¸° ë¶„ì„] ê·¼ë¬˜í™”ì‹¤ ê¸°ë°˜
   - year: ì´ˆë…„ê¸°(0~19ì„¸) - ë¶€ëª¨ìš´, ì„±ì¥ í™˜ê²½, ì„±ê²©ì˜ ë¿Œë¦¬ (ìµœì†Œ 5ë¬¸ì¥)
   - month: ì²­ë…„ê¸°(20~39ì„¸) - ì‚¬íšŒìƒí™œ, ì§ì—…ì  ë„ì „, ìì•„ì‹¤í˜„ (ìµœì†Œ 5ë¬¸ì¥)
   - day: ì¤‘ë…„ê¸°(40~59ì„¸) - ìì‚° í˜•ì„±, ì¸ìƒì˜ ê½ƒ, ê°€ì •ìš´ (ìµœì†Œ 5ë¬¸ì¥)
   - hour: ë§ë…„ê¸°(60ì„¸~) - ê²°ì‹¤, ìë…€ë³µ, ë…¸í›„ì˜ í‰ì˜¨í•¨ (ìµœì†Œ 5ë¬¸ì¥)
3. daewoon_trend: [ëŒ€ìš´ì˜ íë¦„] í˜„ì¬ ëŒ€ìš´ì„ ì¤‘ì‹¬ìœ¼ë¡œ 10ë…„ ì£¼ê¸° ë³€í™”ì˜ ì˜ë¯¸ì™€ ê¸°íšŒ
4. health_analysis: [ê±´ê°• & ì²´ì§ˆ] ì˜¤í–‰ ë°¸ëŸ°ìŠ¤ ê¸°ë°˜ ì‹ ì²´ íŠ¹ì§•, ì·¨ì•½ ë¶€ìœ„, íë§ ì œì•ˆ
5. social_analysis: [ì‚¬íšŒìš´ & ì ì„±] ëŒ€ì¸ê´€ê³„ ìŠ¤íƒ€ì¼, ì¡°ì§ ì ì‘ë„, ì¶”ì²œ ì§ì—…
6. personality_deep: [ì¸ì„± & ì„±í–¥] ë‚´ë©´ì˜ ì¸í’ˆ, ìˆ¨ê²¨ì§„ ì¬ëŠ¥, ê°ì • ë‹¤ìŠ¤ë¦¬ëŠ” ë²•
7. love_romance: [ì• ì • & ì¸ì—°] ì—°ì•  íŒ¨í„´, ë°°ìš°ì ë³µ, í–‰ë³µí•œ ê´€ê³„ ì¡°ì–¸
8. wealth_strategy: [ì¬ë¬¼ ìš´ìš© ì „ëµ] ëˆ ëª¨ìœ¼ëŠ” ë²•, íˆ¬ì ì„±í–¥, ì†ì‹¤ ë°©ì§€ ë¹„ì±…
9. today_luck: [ì˜¤ëŠ˜ì˜ ì—ë„ˆì§€] ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ìœ„í•œ ê°•ë ¬í•˜ê³  ë”°ëœ»í•œ ê²©ì–¸

# Instruction for Quality
1. [Tone]: ì „ë¬¸ ìš©ì–´ë¥¼ í˜„ëŒ€ì  ì‹¬ë¦¬í•™ ìš©ì–´ì™€ ë¹„ìœ ë¡œ í’€ì–´ë‚´ì–´ ê³µê° ê·¹ëŒ€í™”
2. [Volume]: ê° í…ìŠ¤íŠ¸ëŠ” ìê¸°ê³„ë°œì„œë‚˜ ìœ„ë¡œì˜ í¸ì§€ì²˜ëŸ¼ í’ì„±í•˜ê²Œ ì‘ì„±
3. [Context]: ì‚¬ìš©ì ì—°ë ¹ì„ ê³ ë ¤í•˜ì—¬ í˜„ì¬ ê³ ë¯¼í•  ë²•í•œ ì§€ì ì„ ì •í™•íˆ ì§šì–´ì£¼ì„¸ìš”
```

---

## âš™ï¸ API í˜¸ì¶œ ì„¤ì •

```python
response = self.client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {
            "role": "system", 
            "content": "ë‹¹ì‹ ì€ í˜„ëŒ€ì  ê°ê°ì„ ê°€ì§„ ì‚¬ì£¼ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ë‹µë³€í•˜ë©°, ê°’ì€ í•­ìƒ ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤."
        },
        {"role": "user", "content": prompt}
    ],
    response_format={"type": "json_object"},
    temperature=0.7,
    timeout=120  # 120ì´ˆ íƒ€ì„ì•„ì›ƒ
)

return json.loads(response.choices[0].message.content)
```

---

## ğŸ“¤ ë°˜í™˜ JSON êµ¬ì¡°

```json
{
    "total_summary": "ë‹¹ì‹ ì€ íƒ€ê³ ë‚œ ë¦¬ë”ì‹­ê³¼ ê¹Šì€ ë‚´ë©´ì˜ ì§€í˜œë¥¼ ê°€ì§„ ì‚¬ëŒì…ë‹ˆë‹¤...(8-12ë¬¸ì¥)",
    "gmhs": {
        "year": "ì´ˆë…„ê¸°ì˜ ë‹¹ì‹ ì€ í™œë°œí•œ ì—ë„ˆì§€ë¥¼ ê°€ì§€ê³ ...(5ë¬¸ì¥ ì´ìƒ)",
        "month": "ì²­ë…„ê¸°ì—ëŠ” ì‚¬íšŒì  ë„ì „ì´ ì‹œì‘ë˜ë©°...(5ë¬¸ì¥ ì´ìƒ)",
        "day": "ì¤‘ë…„ê¸°ëŠ” ë‹¹ì‹  ì¸ìƒì˜ ê½ƒì´ í”¼ëŠ” ì‹œê¸°ë¡œ...(5ë¬¸ì¥ ì´ìƒ)",
        "hour": "ë§ë…„ê¸°ì—ëŠ” ì§€í˜œë¡œìš´ ì–´ë¥¸ìœ¼ë¡œì„œ...(5ë¬¸ì¥ ì´ìƒ)"
    },
    "daewoon_trend": "í˜„ì¬ ë‹¹ì‹ ì˜ ëŒ€ìš´ì€...(8-12ë¬¸ì¥)",
    "health_analysis": "ì˜¤í–‰ ë°¸ëŸ°ìŠ¤ë¥¼ ë³´ë©´ í™” ê¸°ìš´ì´ ê°•í•˜ì—¬...(8-12ë¬¸ì¥)",
    "social_analysis": "ëŒ€ì¸ê´€ê³„ì—ì„œ ë‹¹ì‹ ì€...(8-12ë¬¸ì¥)",
    "personality_deep": "ë‚´ë©´ì˜ ë‹¹ì‹ ì€...(8-12ë¬¸ì¥)",
    "love_romance": "ì—°ì•  íŒ¨í„´ì„ ë³´ë©´...(8-12ë¬¸ì¥)",
    "wealth_strategy": "ì¬ë¬¼ìš´ì„ ë¶„ì„í•˜ë©´...(8-12ë¬¸ì¥)",
    "today_luck": "ì˜¤ëŠ˜ì€ ë‹¹ì‹ ì˜ ì—ë„ˆì§€ê°€...(3-5ë¬¸ì¥)"
}
```

---

## ğŸ”„ Fallback ì²˜ë¦¬

API í˜¸ì¶œ ì‹¤íŒ¨ ë˜ëŠ” API í‚¤ ì—†ìŒ ì‹œ:
```python
if not self.client:
    return None  # app.pyì—ì„œ ê¸°ë³¸ saju_logic ê²°ê³¼ ì‚¬ìš©
```

---

## ğŸ“Š app.pyì—ì„œì˜ AI ë°ì´í„° ë³‘í•©

```python
if ai_data:
    # AI ê²°ê³¼ë¡œ ë®ì–´ì“°ê¸°
    interpretations['total_summary'] = ai_data.get('total_summary', "...")
    interpretations['personality_deep'] = ai_data.get('personality_deep', "...")
    interpretations['social_analysis'] = ai_data.get('social_analysis', "...")
    interpretations['health_analysis'] = ai_data.get('health_analysis', "...")
    interpretations['daewoon_trend'] = ai_data.get('daewoon_trend', "...")
    interpretations['love_romance'] = ai_data.get('love_romance', interpretations['love'])
    interpretations['wealth_strategy'] = ai_data.get('wealth_strategy', interpretations['wealth'])
    
    # ë ˆê±°ì‹œ í‚¤ í˜¸í™˜
    interpretations['core'] = ai_data.get('personality_deep', interpretations['core'])
    interpretations['advice'] = ai_data.get('health_analysis', interpretations['advice'])
    
    # GMHS ì‹¬ì¸µ ë¶„ì„ ë³‘í•©
    if 'gmhs' in ai_data:
        for period in ['year', 'month', 'day', 'hour']:
            interpretations['gmhs'][period]['desc'] = ai_data['gmhs'][period]
    
    # ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë³‘í•©
    if 'today_luck' in ai_data:
        interpretations['today_luck']['desc'] = str(ai_data['today_luck'])
```
